<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>EGFR Structures (interactive)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://3dmol.org/build/3Dmol-min.js"></script>
  <style>
    :root{ --accent:#f28c28; --bg:#f6f7fb; --panel:#fff; --border:#e6e8ef; }
    html,body{height:100%;margin:0;background:var(--bg);font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    header{background:var(--accent);color:#fff;padding:12px 16px;font-weight:700}
    .grid{display:grid;gap:14px;padding:14px;grid-template-columns:repeat(auto-fit,minmax(420px,1fr))}
    .card{background:var(--panel);border:1px solid var(--border);border-radius:12px;box-shadow:0 1px 3px rgba(0,0,0,.05);overflow:hidden;display:flex;flex-direction:column;min-height:420px}
    .card h3{margin:0;padding:10px 14px;font-size:15px;border-bottom:1px solid var(--border)}
    .view{flex:1;min-height:360px}
    .hint{padding:0 14px 10px;color:#6b7280;font-size:12px}
    .err{padding:12px;color:#b00020}
  </style>
</head>
<body>
  <header>EGFR Structures (interactive) — drag to rotate, scroll to zoom</header>

  <div class="grid">
    <div class="card"><h3>EGFR + Erlotinib (T790W)</h3><div id="v1" class="view"></div><div class="hint">Cartoon protein + ligand sticks</div></div>
    <div class="card"><h3>EGFR + Erlotinib (WT)</h3>   <div id="v2" class="view"></div><div class="hint">Cartoon protein + ligand sticks</div></div>
    <div class="card"><h3>EGFR + Osimertinib (C797F)</h3><div id="v3" class="view"></div><div class="hint">Cartoon protein + ligand sticks</div></div>
    <div class="card"><h3>EGFR + Osimertinib (WT)</h3> <div id="v4" class="view"></div><div class="hint">Cartoon protein + ligand sticks</div></div>
  </div>

  <script>
  const RAW_BASE =
    "https://raw.githubusercontent.com/Mohammed-Balkhair-hub/Boltz-2_-Benchmark/refs/heads/main/";

  async function tryFetch(url) {
    const r = await fetch(url, { cache: "no-store" });
    if (!r.ok) throw new Error(`${r.status} ${r.statusText} for ${url}`);
    return r.text();
  }

  async function fetchPDB(basename) {
    // 1) same-origin (GitHub Pages) — best for CORS
    const local = basename;
    // 2) raw fallback (different origin)
    const raw = RAW_BASE + basename;

    try { return await tryFetch(local); }
    catch (e1) {
      console.warn("Local fetch failed, trying RAW:", e1);
      try { return await tryFetch(raw); }
      catch (e2) { throw e2; }
    }
  }

  async function loadPanel(divId, pdbName) {
    const el = document.getElementById(divId);
    const viewer = $3Dmol.createViewer(el, { backgroundAlpha: 1.0 });

    try {
      const pdb = await fetchPDB(pdbName);

      viewer.addModel(pdb, "pdb");
      viewer.setStyle({}, {}); // clear defaults

      // Protein cartoon (fallback to tube if no SS info)
      viewer.setStyle({ hetflag: false }, { cartoon: { color: "spectrum" } });
      const prot = viewer.getModel().selectedAtoms({ hetflag: false });
      if (!prot || prot.length === 0) {
        viewer.setStyle({ atom: "CA" }, { tube: { radius: 0.35, color: "spectrum" } });
      }

      // Ligand sticks (het)
      viewer.setStyle({ hetflag: true }, { stick: { radius: 0.22 } });

      // Zoom (prefer ligand)
      const lig = viewer.getModel().selectedAtoms({ hetflag: true });
      if (lig && lig.length) viewer.zoomTo({ hetflag: true }); else viewer.zoomTo();

      viewer.render();
      const onResize = () => viewer.resize();
      window.addEventListener("resize", onResize, { passive: true });
    } catch (err) {
      console.error("Load error:", pdbName, err);
      el.innerHTML = `<div style="padding:12px;color:#b00020;font:14px/1.4 system-ui">
        ⚠️ Couldn’t load <b>${pdbName}</b>.<br>
        <code>${String(err.message)}</code><br>
        Check that the file exists on your GitHub Pages branch and the name (including UPPER/lower case) matches exactly.
      </div>`;
    }
  }

  // Filenames must match exactly
  loadPanel('v1', 'EGFR_erlotinib_T790W_trimmed.pdb');
  loadPanel('v2', 'EGFR_erlotinib_trimmed.pdb');
  loadPanel('v3', 'EGFR_osimertinib_C797F_trimmed.pdb');
  loadPanel('v4', 'EGFR_osimertinib_trimmed.pdb');
</script>
</body>
</html>
